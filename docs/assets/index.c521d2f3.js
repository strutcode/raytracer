var b=Object.defineProperty;var w=Object.getOwnPropertySymbols;var z=Object.prototype.hasOwnProperty,S=Object.prototype.propertyIsEnumerable;var p=(r,t,e)=>t in r?b(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,d=(r,t)=>{for(var e in t||(t={}))z.call(t,e)&&p(r,e,t[e]);if(w)for(var e of w(t))S.call(t,e)&&p(r,e,t[e]);return r};const M=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const n of i)if(n.type==="childList")for(const o of n.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function e(i){const n={};return i.integrity&&(n.integrity=i.integrity),i.referrerpolicy&&(n.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?n.credentials="include":i.crossorigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(i){if(i.ep)return;i.ep=!0;const n=e(i);fetch(i.href,n)}};M();class c{constructor(t=0,e=0,s=0,i=1){this.r=t,this.g=e,this.b=s,this.a=i}add(t){return t instanceof c?new c(this.r+t.r,this.g+t.g,this.b+t.b,this.a):new c(this.r+t,this.g+t,this.b+t,this.a)}mul(t){return t instanceof c?new c(this.r*t.r,this.g*t.g,this.b*t.b,this.a):new c(this.r*t,this.g*t,this.b*t,this.a)}}class L{constructor(t,e=new c(1,1,1)){this.position=t,this.color=e}contribution(t){const s=this.position.sub(t.origin).normalize().dot(t.direction);return s<=0?new c(0,0,0):new c(this.color.r*s,this.color.g*s,this.color.b*s,1)}}class v{constructor(t){this.material=t}}class q{constructor(t,e,s,i){this.ray=t,this.t=e,this.material=s,this.normal=i,this.position=this.ray.origin.add(this.ray.direction.mul(this.t))}}class B extends v{constructor(t,e,s){super(s),this.center=t,this.radius=e,this.material=s}intersect(t){const e=this.center.sub(t.origin),s=t.direction.dot(e);if(s<=0)return null;const i=Math.sqrt(e.dot(e)-s*s);if(i>this.radius)return null;const n=Math.sqrt(this.radius*this.radius-i*i),o=s-n,a=t.origin.add(t.direction.mul(o));return new q(t,o,this.material,a.sub(this.center).normalize())}}class O{constructor(t=new c(.5,.5,.5),e=.5,s=0){this.color=t,this.shine=e,this.gloss=s}}class I{async renderSequence(t){for(;t.hasNext();)this.render(await t.next())}}class y{constructor(t,e){this.origin=t,this.direction=e}}class h{constructor(t=0,e=0,s=0){this.x=t,this.y=e,this.z=s}add(t){return t instanceof h?new h(this.x+t.x,this.y+t.y,this.z+t.z):new h(this.x+t,this.y+t,this.z+t)}sub(t){return t instanceof h?new h(this.x-t.x,this.y-t.y,this.z-t.z):new h(this.x-t,this.y-t,this.z-t)}mul(t){return t instanceof h?new h(this.x*t.x,this.y*t.y,this.z*t.z):new h(this.x*t,this.y*t,this.z*t)}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}reflect(t){return this.sub(t.mul(2*this.dot(t)))}get length(){return Math.sqrt(this.dot(this))}normalize(){const t=this.length;return new h(this.x/t,this.y/t,this.z/t)}}class N{trace(t,e,s=0){const i=t.intersect(e);if(i){const n=i.material.color;let o=new c;return t.eachLight(a=>{o=o.add(n.mul(a.contribution(new y(i.position,i.normal))))}),o}else return new c(0,0,0)}}const R={};class D extends I{constructor(t){super(),this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.raytracer=new N;const e=d(d({},R),t);this.frameBuffer=new Uint8ClampedArray(e.width*e.height*4),this.resize(e.width,e.height),Object.assign(this.canvas.style,{position:"fixed",top:0,left:0,width:"100%",height:"100%"}),document.body.appendChild(this.canvas)}resize(t,e){this.canvas.width=t,this.canvas.height=e}render(t){const{width:e,height:s}=this.canvas;for(let i=0;i<s;i++)for(let n=0;n<e;n++){const o=new y(new h(n,i,0),new h(0,0,1)),a=this.raytracer.trace(t,o),u=(i*e+n)*4;this.frameBuffer[u+0]=Math.round(a.r*255),this.frameBuffer[u+1]=Math.round(a.g*255),this.frameBuffer[u+2]=Math.round(a.b*255),this.frameBuffer[u+3]=Math.round(a.a*255)}this.context.putImageData(new ImageData(this.frameBuffer,e,s),0,0)}}class P{constructor(){this.background=new c,this.shapes=[],this.lights=[]}addShape(t){return this.shapes.push(t),t}addLight(t){return this.lights.push(t),t}eachLight(t){this.lights.forEach(t)}intersect(t,e=1/0){let s=null;for(const i of this.shapes){const n=i.intersect(t);!n||(!s||(n==null?void 0:n.t)<(s==null?void 0:s.t))&&(s=n)}return s&&(s==null?void 0:s.t)>e?null:s}}class A{}class E extends A{constructor(t){super(),this.scene=t}hasNext(){return!0}async next(){return new Promise(t=>{requestAnimationFrame(()=>{this.onStep&&this.onStep(this.scene),t(this.scene)})})}}const g=new P,f=g.addShape(new B(new h(180,120,500),100,new O(new c(.2,.85,1)))),m=g.addLight(new L(new h(-500,0,250))),F=new D({width:360,height:240}),x=new E(g);let l=0;x.onStep=()=>{l+=.01,f.center.x=180+Math.sin(l)*80,m.position.x=f.center.x+Math.sin(l)*500,m.position.z=f.center.z+Math.cos(l)*500};F.renderSequence(x);
